
<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-atom">
  <p style="color: white" align="center">Por favor espere... <br>¡Validando información!</p>
</ngx-spinner>
<c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <strong>Solicitudes de revisión de datos por Migración</strong> &nbsp; <small>Módulo para gestión de solicitudes de revisión de datos por migración de información</small>
      </c-card-header>
      <c-card-body >
        <c-nav variant="tabs">
          <c-nav-item class="ms-3">
            <a 
              [cTabContent]="tabContent1" 
              [routerLink] 
              [tabPaneIdx]="0" 
              cNavLink 
              [ngClass]="{'active-tab': tabContent1.activeTabPaneIdx === 0}"
              class="d-flex align-items-center position-relative"
              [style.border]="tabContent1.activeTabPaneIdx === 0 ? '2px solid white' : '2px solid #003E85'"
      [style.backgroundColor]="tabContent1.activeTabPaneIdx === 0 ? '#003E85' : 'transparent'"
      [style.color]="tabContent1.activeTabPaneIdx === 0 ? '#fff' : '#003E85'">
              <svg cIcon class="me-2" name="cilInbox"></svg>
              Recibidas
              <c-badge 
                *ngIf="!cargandoDatos && recibidas.data.length > 0" 
                color="danger" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                {{ recibidas.data.length > 99 ? '99+' : recibidas.data.length }}
              </c-badge>
              <c-badge 
                *ngIf="!cargandoDatos && recibidas.data.length === 0" 
                color="success" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                <svg cIcon name="cilCheckCircle" width="12" height="12"></svg>
              </c-badge>
            </a>
          </c-nav-item>
        
          <c-nav-item class="ms-3">
            <a 
              [cTabContent]="tabContent1" 
              [routerLink] 
              [tabPaneIdx]="1" 
              cNavLink 
              [ngClass]="{'active-tab': tabContent1.activeTabPaneIdx === 1}"
              class="d-flex align-items-center position-relative"
              [style.border]="tabContent1.activeTabPaneIdx === 1 ? '2px solid white' : '2px solid #003E85'"
      [style.backgroundColor]="tabContent1.activeTabPaneIdx === 1 ? '#003E85' : 'transparent'"
      [style.color]="tabContent1.activeTabPaneIdx === 1 ? '#fff' : '#003E85'">
              <svg cIcon class="me-2" name="cilSync"></svg>
              En proceso
              <c-badge 
              *ngIf="!cargandoDatos && gestionadas.data.length > 0" 
                color="warning" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                {{ gestionadas.data.length > 99 ? '99+' : gestionadas.data.length }}
              </c-badge>
              <c-badge 
                *ngIf="!cargandoDatos && gestionadas.data.length === 0" 
                color="success" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                <svg cIcon name="cilCheckCircle" width="12" height="12"></svg>
              </c-badge>
            </a>
          </c-nav-item>
          <c-nav-item class="ms-3">
            <a 
              [cTabContent]="tabContent1" 
              [routerLink] 
              [tabPaneIdx]="2" 
              cNavLink 
              [ngClass]="{'active-tab': tabContent1.activeTabPaneIdx === 2}"
              class="d-flex align-items-center position-relative"
              [style.border]="tabContent1.activeTabPaneIdx === 2 ? '2px solid white' : '2px solid #003E85'"
      [style.backgroundColor]="tabContent1.activeTabPaneIdx === 2 ? '#003E85' : 'transparent'"
      [style.color]="tabContent1.activeTabPaneIdx === 2 ? '#fff' : '#003E85'">
      <svg cIcon class="me-2" name="cilClock"></svg>
              Diferidas
              <c-badge 
                *ngIf="!cargandoDatos && diferidas.data.length > 0" 
                color="warning" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                {{ diferidas.data.length > 99 ? '99+' : diferidas.data.length }}
              </c-badge>
              <c-badge 
                *ngIf="!cargandoDatos && diferidas.data.length === 0" 
                color="success" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                <svg cIcon name="cilCheckCircle" width="12" height="12"></svg>
              </c-badge>
            </a>
          </c-nav-item>
          <c-nav-item class="ms-3">
            <a 
              [cTabContent]="tabContent1" 
              [routerLink] 
              [tabPaneIdx]="3" 
              cNavLink 
              [ngClass]="{'active-tab': tabContent1.activeTabPaneIdx === 3}"
              class="d-flex align-items-center position-relative"
              [style.border]="tabContent1.activeTabPaneIdx === 3 ? '2px solid white' : '2px solid #003E85'"
      [style.backgroundColor]="tabContent1.activeTabPaneIdx === 3 ? '#003E85' : 'transparent'"
      [style.color]="tabContent1.activeTabPaneIdx === 3 ? '#fff' : '#003E85'">
              <svg cIcon class="me-2" name="cilCheckCircle"></svg>
              Procesadas              
              <c-badge 
              *ngIf="!cargandoDatos && procesadas.data.length > 0" 
                color="success" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                {{ procesadas.data.length > 99 ? '99+' : procesadas.data.length }}
              </c-badge>
              <c-badge 
              *ngIf="!cargandoDatos && procesadas.data.length === 0" 
                color="success" 
                shape="rounded-pill" 
                class="position-absolute badge-adjusted">
                <svg cIcon name="cilCheckCircle" width="12" height="12"></svg>
              </c-badge>
            </a>
          </c-nav-item>
        </c-nav>
        
        
        
          <c-tab-content #tabContent1="cTabContent" [activeTabPaneIdx]="0" cRounded="bottom">
            <c-tab-pane class="p-3 preview" role="tabpanel">
                <div *ngIf="hayResultadosRecibidas">
                    <mat-form-field>
                        <input matInput (keyup)="applyFilterRecibidas($event)" placeholder="Buscar solicitud recibida" #input>
                      </mat-form-field>
                      <table mat-table [dataSource]="recibidas" [hover]="true"
                      [responsive]="true"
                      [striped]="true"
                      align="middle"
                      cTable
                      class="mb-0 border" cTable>
                        <ng-container matColumnDef="fecha_solicitud">
                          <th mat-header-cell *matHeaderCellDef> Fecha de solicitud </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.fecha_solicitud}} </td>
                        </ng-container>
                        <ng-container matColumnDef="id_estudiante">
                          <th mat-header-cell *matHeaderCellDef> Identificación </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.id_estudiante}} </td>
                        </ng-container>
                        <ng-container matColumnDef="nombre_completo">
                          <th mat-header-cell *matHeaderCellDef> Apellidos y nombres </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.nombre_completo}} </td>
                        </ng-container>
                        <ng-container matColumnDef="tipo_revision">
                          <th mat-header-cell *matHeaderCellDef> Tipo revisión </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.desc_tipo_revision}} </td>
                        </ng-container>
                        <ng-container matColumnDef="gestion">
                            <th mat-header-cell *matHeaderCellDef> Gestionar </th>
                            <td mat-cell *matCellDef="let solicitud">
              <div class="button-container">
                <button *ngIf="solicitud.tipo_revision === 'RDI'"  
        cButton 
        [ngClass]="solicitud.en_gestion ? 'btn-secondary' : 'btn-primary'" 
        data-toggle="modal" 
        size="sm" 
        (click)="abrirModalRevision(solicitud.cedula)"
        [cTooltip]="solicitud.en_gestion ? 'En gestión por: ' + solicitud.nombre_gestor : 'Gestionar'"
        cTooltipPlacement="top">
  <svg cIcon [name]="solicitud.en_gestion ? 'cilLockLocked' : 'cilMagnifyingGlass'"></svg>
</button>


                  <button *ngIf="solicitud.tipo_revision === 'RPM'"  cButton 
                  [ngClass]="solicitud.en_gestion ? 'btn-secondary' : 'btn-primary'" 
                  data-toggle="modal" 
                  size="sm" 
                  (click)="irAGestionPostMigracion(solicitud.cedula)"
                  [cTooltip]="solicitud.en_gestion ? 'En gestión por: ' + solicitud.nombre_gestor : 'Gestionar'"
                  cTooltipPlacement="top" >
                  <svg cIcon [name]="solicitud.en_gestion ? 'cilLockLocked' : 'cilMagnifyingGlass'"></svg>
                  </button>
              </div>
                            </td>
                          </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedColumnsRecibidas"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsRecibidas;"></tr>
                      </table>
                      
                </div>
                <div *ngIf="sinResultadosRecibidas">
                    <c-alert color="success" class="d-flex align-items-center">
                      <svg cIcon class="me-2" width="24" height="24" name="cilCheckCircle"></svg>
                      <div>No existen solicitudes por gestionar</div>
                    </c-alert>
                  </div>
                  <mat-paginator  [hidePageSize]="true" [pageSize]="5"  #paginatorRecibidas></mat-paginator>
            </c-tab-pane>
            <c-tab-pane class="p-3 preview" role="tabpanel">
              <div *ngIf="hayResultadosGestionadas">
                  <mat-form-field>
                      <input matInput (keyup)="applyFilterGestionadas($event)" placeholder="Buscar solicitud en proceso de gestión" #input>
                    </mat-form-field>
                    <table mat-table [dataSource]="gestionadas" [hover]="true"
                    [responsive]="true"
                    [striped]="true"
                    align="middle"
                    cTable
                    class="mb-0 border" cTable>
                      <ng-container matColumnDef="fecha_solicitud">
                        <th mat-header-cell *matHeaderCellDef> Fecha de solicitud </th>
                        <td mat-cell *matCellDef="let solicitud"> {{solicitud.fecha_solicitud}} </td>
                      </ng-container>
                      <ng-container matColumnDef="id_estudiante">
                        <th mat-header-cell *matHeaderCellDef> Identificación </th>
                        <td mat-cell *matCellDef="let solicitud"> {{solicitud.id_estudiante}} </td>
                      </ng-container>
                      <ng-container matColumnDef="nombre_completo">
                        <th mat-header-cell *matHeaderCellDef> Apellidos y nombres </th>
                        <td mat-cell *matCellDef="let solicitud"> {{solicitud.nombre_completo}} </td>
                      </ng-container>
                      <ng-container matColumnDef="tipo_revision">
                        <th mat-header-cell *matHeaderCellDef> Tipo revisión </th>
                        <td mat-cell *matCellDef="let solicitud"> {{solicitud.desc_tipo_revision}} </td>
                      </ng-container>
                      <ng-container matColumnDef="gestion">
                          <th mat-header-cell *matHeaderCellDef> Gestionar </th>
                          <td mat-cell *matCellDef="let solicitud">
            <div class="button-container">
              <button *ngIf="solicitud.tipo_revision === 'RDI'"  
      cButton 
      [ngClass]="solicitud.en_gestion ? 'btn-secondary' : 'btn-primary'" 
      data-toggle="modal" 
      size="sm" 
      (click)="abrirModalRevision(solicitud.cedula)"
      [cTooltip]="solicitud.en_gestion ? 'En gestión por: ' + solicitud.nombre_gestor : 'Gestionar'"
      cTooltipPlacement="top">
<svg cIcon [name]="solicitud.en_gestion ? 'cilLockLocked' : 'cilMagnifyingGlass'"></svg>
</button>


                <button *ngIf="solicitud.tipo_revision === 'RPM'"  cButton 
                [ngClass]="solicitud.en_gestion ? 'btn-secondary' : 'btn-primary'" 
                data-toggle="modal" 
                size="sm" 
                (click)="irAGestionPostMigracion(solicitud.cedula)"
                [cTooltip]="solicitud.en_gestion ? 'En gestión por: ' + solicitud.nombre_gestor : 'Gestionar'"
                cTooltipPlacement="top" >
                <svg cIcon [name]="solicitud.en_gestion ? 'cilLockLocked' : 'cilMagnifyingGlass'"></svg>
                </button>
            </div>
                          </td>
                        </ng-container>
                      <tr mat-header-row *matHeaderRowDef="displayedColumnsGestion"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumnsGestion;"></tr>
                    </table>
                    
              </div>
              <div *ngIf="sinResultadosGestionadas">
                  <c-alert color="success" class="d-flex align-items-center">
                    <svg cIcon class="me-2" width="24" height="24" name="cilCheckCircle"></svg>
                    <div>No existen solicitudes en proceso de gestión</div>
                  </c-alert>
                </div>
                <mat-paginator  [hidePageSize]="true" [pageSize]="5"  #paginatorGestionadas></mat-paginator>
          </c-tab-pane>
          <c-tab-pane class="p-3 preview" role="tabpanel">
            <div *ngIf="hayResultadosDiferidas">
                <mat-form-field>
                    <input matInput (keyup)="applyFilterDiferidas($event)" placeholder="Buscar solicitud diferida" #input>
                  </mat-form-field>
                  <table mat-table [dataSource]="diferidas" [hover]="true"
                  [responsive]="true"
                  [striped]="true"
                  align="middle"
                  cTable
                  class="mb-0 border" cTable>
                    <ng-container matColumnDef="fecha_solicitud">
                      <th mat-header-cell *matHeaderCellDef> Fecha de solicitud </th>
                      <td mat-cell *matCellDef="let solicitud"> {{solicitud.fecha_solicitud}} </td>
                    </ng-container>
                    <ng-container matColumnDef="id_estudiante">
                      <th mat-header-cell *matHeaderCellDef> Identificación </th>
                      <td mat-cell *matCellDef="let solicitud"> {{solicitud.id_estudiante}} </td>
                    </ng-container>
                    <ng-container matColumnDef="nombre_completo">
                      <th mat-header-cell *matHeaderCellDef> Apellidos y nombres </th>
                      <td mat-cell *matCellDef="let solicitud"> {{solicitud.nombre_completo}} </td>
                    </ng-container>
                    <ng-container matColumnDef="tipo_revision">
                      <th mat-header-cell *matHeaderCellDef> Tipo revisión </th>
                      <td mat-cell *matCellDef="let solicitud"> {{solicitud.desc_tipo_revision}} </td>
                    </ng-container>
                    <ng-container matColumnDef="gestion">
                        <th mat-header-cell *matHeaderCellDef> Gestionar </th>
                        <td mat-cell *matCellDef="let solicitud">
          <div class="button-container">
            <button *ngIf="solicitud.tipo_revision === 'RDI'"  
    cButton 
    [ngClass]="solicitud.en_gestion ? 'btn-secondary' : 'btn-primary'" 
    data-toggle="modal" 
    size="sm" 
    (click)="abrirModalRevision(solicitud.cedula)"
    [cTooltip]="solicitud.en_gestion ? 'En gestión por: ' + solicitud.nombre_gestor : 'Gestionar'"
    cTooltipPlacement="top">
<svg cIcon [name]="solicitud.en_gestion ? 'cilLockLocked' : 'cilMagnifyingGlass'"></svg>
</button>


              <button *ngIf="solicitud.tipo_revision === 'RPM'"  cButton 
              [ngClass]="solicitud.en_gestion ? 'btn-secondary' : 'btn-primary'" 
              data-toggle="modal" 
              size="sm" 
              (click)="irAGestionPostMigracion(solicitud.cedula)"
              [cTooltip]="solicitud.en_gestion ? 'En gestión por: ' + solicitud.nombre_gestor : 'Gestionar'"
              cTooltipPlacement="top" >
              <svg cIcon [name]="solicitud.en_gestion ? 'cilLockLocked' : 'cilMagnifyingGlass'"></svg>
              </button>
          </div>
                        </td>
                      </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumnsDiferidas"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumnsDiferidas;"></tr>
                  </table>
                  
            </div>
            <div *ngIf="sinResultadosDiferidas">
                <c-alert color="success" class="d-flex align-items-center">
                  <svg cIcon class="me-2" width="24" height="24" name="cilCheckCircle"></svg>
                  <div>No existen solicitudes diferidas</div>
                </c-alert>
              </div>
              <mat-paginator  [hidePageSize]="true" [pageSize]="5"  #paginatorDiferidas></mat-paginator>
        </c-tab-pane>
            <c-tab-pane class="p-3 preview" role="tabpanel">
                <div *ngIf="hayResultadosProcesadas">
                    <mat-form-field>
                        <input matInput (keyup)="applyFilterProcesadas($event)" placeholder="Buscar solicitud procesada" #input>
                      </mat-form-field>
                      <table mat-table [dataSource]="procesadas"  [hover]="true"
                      [responsive]="true"
                      [striped]="true"
                      align="middle"
                      cTable
                      class="mb-0 border" cTable>
                        <ng-container matColumnDef="estatus">
                            <th mat-header-cell *matHeaderCellDef> Estatus </th>
                            <td mat-cell *matCellDef="let solicitud">
                                <div class="container" cTooltip="{{solicitud.desc_estatus}}" cTooltipPlacement="right">
                                    <svg *ngIf="solicitud.estatus == '0'" cIcon width="30" height="30" name="cilCheckCircle" style="color: #2EB85C;" ></svg>
                                    <svg *ngIf="solicitud.estatus == '1'" cIcon width="30" height="30" name="cilToggleOn" style="color: #2EB85C;" ></svg>
                                    <svg *ngIf="solicitud.estatus == '4'" cIcon width="30" height="30" name="cilXCircle" style="color: orangered;"></svg>
                                  </div>
                            </td>
                          </ng-container>
                        <ng-container matColumnDef="id_estudiante">
                          <th mat-header-cell *matHeaderCellDef> Identificación </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.id_estudiante}} </td>
                        </ng-container>
                        <ng-container matColumnDef="nombre_completo">
                          <th mat-header-cell *matHeaderCellDef> Apellidos y nombres </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.nombre_completo}} </td>
                        </ng-container>
                        <ng-container matColumnDef="telefono">
                          <th mat-header-cell *matHeaderCellDef> Teléfono </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.celular}} </td>
                        </ng-container>
                        <ng-container matColumnDef="pnf">
                          <th mat-header-cell *matHeaderCellDef> PNF </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.nombre_programa}} </td>
                        </ng-container>
                        <ng-container matColumnDef="usrproceso">
                          <th mat-header-cell *matHeaderCellDef> Procesado por </th>
                          <td mat-cell *matCellDef="let solicitud"> {{solicitud.nombre_corto}} </td>
                        </ng-container>
                       
                        <tr mat-header-row *matHeaderRowDef="displayedColumnsProcesadas"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsProcesadas;"></tr>
                      </table>
                </div>
                <div *ngIf="sinResultadosProcesadas">
                    <c-alert color="info" class="d-flex align-items-center">
                      <svg cIcon class="me-2" width="24" height="24" name="cilCheckCircle"></svg>
                      <div>No existen solicitudes procesadas</div>
                    </c-alert>
                  </div>
                  <mat-paginator [hidePageSize]="true" [pageSize]="5" #paginatorProcesadas></mat-paginator>
            </c-tab-pane>
          </c-tab-content>
      </c-card-body>
    </c-card>
  </c-col>
