<div class="modal-header">
  <h4 class="modal-title">Bienvenid&#64; al proceso de migraci√≥n de datos de la UNETRANS</h4>
</div>
<div class="modal-body">
  <div *ngIf="estudianteBase.estatus_migra === 3">
    <div class="alert alert-warning" role="alert">
      <strong>Hola {{ estudianteBase.nombre_corto }}!</strong>
      <p>Hemos identificado incongruencias en tu perfil que requieren atenci√≥n antes de continuar con el proceso de
        migraci√≥n. Es necesario que solicites una revisi√≥n para ajustar y validar esta informaci√≥n. Una vez completado
        este paso, procederemos internamente a actualizar tu expediente y te informaremos por correo electr√≥nico para
        que puedas avanzar en el proceso.</p>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="termsCheckbox" [(ngModel)]="termsAccepted">
      <label class="form-check-label" for="termsCheckbox">
        Acepto solicitar la revisi√≥n necesaria.
      </label>
    </div>
    <div>

    </div>
    <form [formGroup]="form">
      <div class="row" *ngIf="termsAccepted">
        <div class="col l12 m12 s12">
          <label>Verificaci√≥n del correo electr√≥nico:</label>
          <div class="row mar-b-0">
            <div class="col s12">
              <mat-form-field appearance="fill">
                <mat-label>Correo electr√≥nico</mat-label>
                <input type="email" matInput formControlName="email">
                <button mat-button matSuffix (click)="verifyEmail()" [disabled]="!form.get('email')?.valid || emailDuplicado">Verificar</button>
                <mat-error *ngIf="form.get('email')?.errors?.['emailDuplicado']">
                  El correo ya est√° registrado.
                </mat-error>
                <mat-error *ngIf="form.get('email')?.errors?.['pattern']">
                  Solo se aceptan correos de dominio &#64;gmail.com
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col s12">
              <mat-form-field appearance="fill">
                <mat-label>C√≥digo de verificaci√≥n</mat-label>
                <input type="text" matInput formControlName="validationCode">
                <button mat-button matSuffix (click)="validateCode()" [disabled]="!form.get('validationCode')?.valid">Validar</button>
                <mat-error *ngIf="form.get('validationCode')?.errors?.['minlength']">
                  El c√≥digo debe tener al menos 6 d√≠gitos.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div *ngIf="estudianteBase.estatus_migra === 4">
      <div class="alert alert-info" role="alert">
        <strong>¬°Hola {{ estudianteBase.nombre_corto }}! üëã</strong>
        <p>üìù Hemos recibido tu solicitud de revisi√≥n de datos y actualmente se encuentra en proceso de evaluaci√≥n. Entendemos la importancia de este asunto para ti y queremos asegurarte que estamos trabajando diligentemente para resolverlo lo antes posible.</p>
        <p>‚è≥ El proceso de revisi√≥n es meticuloso y puede requerir algo de tiempo para garantizar que toda la informaci√≥n sea correcta y est√© actualizada. Agradecemos tu paciencia y comprensi√≥n durante este periodo.</p>
        <p>üì¨ Una vez finalizada la revisi√≥n, te notificaremos por correo electr√≥nico los resultados y los pasos a seguir para que puedas continuar con el proceso de migraci√≥n sin inconvenientes.</p>
        <p>üí¨ Si tienes preguntas adicionales o necesitas asistencia durante este tiempo, estamos disponibles en la taquilla de la Universidad de <strong>martes a jueves, 8:30 AM a 12:00 M</strong></p>
      </div>  
  </div>

  

  <div *ngIf="estudianteBase.estatus_migra === 0 || estudianteBase.estatus_migra === 5">
    <div *ngIf="estudianteBase.estatus_migra === 5">
      <c-alert *ngIf="estudianteBase.estatus_migra === 5"  color="success" fade  [visible]="visible">
        üìù Tus datos han sido verificados tras la revisi√≥n solicitada. Por favor, rev√≠salos nuevamente y contin√∫a con los pasos para completar la migraci√≥n.
      </c-alert>
  </div>
    <mat-vertical-stepper [linear]="true" #stepper (selectionChange)="onStepChange($event)">
      <!-- Paso 1: Verificaci√≥n de Datos -->
      <mat-step [stepControl]="firstFormGroup1">
        <form [formGroup]="firstFormGroup1">
          <ng-template matStepLabel>Verifica tus datos</ng-template>
          <c-alert color="info">
            <strong>üì¢ Atenci√≥n, {{ estudianteBase.nombre_corto }}:</strong>
            <p>Revisa con atenci√≥n los siguientes datos en tu perfil y verifica su precisi√≥n:</p>
            <ul>
              <li><strong>Datos personales</strong> (nombres, apellidos).</li>
              <li><strong>Programa de estudio/carrera</strong> actual.</li>
              <li><strong>Cohorte</strong> (A√±o de ingreso).</li>
              <li>Si estudiaste <strong>m√∫ltiples carreras</strong> y solo se muestra la actual, selecciona "Hay datos incorrectos" para solicitar una revisi√≥n.</li>
            </ul>
            <p>Si todo est√° correcto, selecciona "Mis datos son correctos". Si hay errores, elige "Hay datos incorrectos" y especifica qu√© necesita correcci√≥n. Para ayuda adicional, visita la taquilla de la universidad de <strong>martes a jueves, de 8:30 AM a 12:00 M</strong>, o contacta soporte.</p>
          </c-alert>
          
          <div class="estudiante-container">
            <div class="datos-estudiante">
              <div class="carnet-info">
                <p><strong>Carnet:</strong> {{ estudianteBase.carnet_formateado }}
                  <span class="carnet-comment">‚Äî Este n√∫mero es solo informativo y representa tu nueva identificaci√≥n en el sistema.</span></p>
              </div>
              <div class="nombres">
                <p><strong>Primer nombre:</strong> {{ estudianteBase.primer_nombre }}</p>
                <p><strong>Segundo nombre:</strong> {{ estudianteBase.segundo_nombre }}</p>
              </div>
              <div class="apellidos">
                <p><strong>Primer apellido:</strong> {{ estudianteBase.primer_apellido }}</p>
                <p><strong>Segundo apellido:</strong> {{ estudianteBase.segundo_apellido }}</p>
              </div>
              <div class="cohorte-carrera">
                <p><strong>Cohorte:</strong> {{ estudianteBase.cohorte }}</p>
                <p><strong>PNF/Carrera:</strong> {{ estudianteBase.pnf }}</p>
              </div>
            </div>
          </div>
          <div class="validation-options">
            <mat-radio-group formControlName="datosCorrectos">
              <mat-radio-button value="si">Mis datos son correctos</mat-radio-button>
              <mat-radio-button value="no">Hay datos incorrectos</mat-radio-button>
            </mat-radio-group>
          </div>
          <button cButton btn btn-primary size="sm" matStepperNext [disabled]="!firstFormGroup1.valid">Continuar</button>
        </form>
      </mat-step>
    
      <!-- Paso 2: Declaraci√≥n Jurada o Correcci√≥n de Datos -->
      <mat-step [stepControl]="secondFormGroup2">
        <form [formGroup]="secondFormGroup2">
          <ng-template matStepLabel>Declaraci√≥n o Correcci√≥n</ng-template>
           <!-- Contenido para declaraci√≥n jurada -->
           <div *ngIf="firstFormGroup1.get('datosCorrectos')?.value === 'si'">
            <strong><p>Declaraci√≥n Jurada de Confirmaci√≥n de Datos</p></strong>
            <p>Yo, <strong>{{ estudianteBase.nombre_completo }}</strong>, titular de la c√©dula de identidad n√∫mero <strong>{{ estudianteBase.nac }}-{{ estudianteBase.cedula }}</strong>, por medio de la presente declaro que:</p>
            <ol>
              <li>He revisado detenidamente la siguiente informaci√≥n personal y acad√©mica:
                <ul>
                  <li><strong>Nombres:</strong> {{ estudianteBase.primer_nombre }} {{ estudianteBase.segundo_nombre }}</li>
                  <li><strong>Apellidos:</strong> {{ estudianteBase.primer_apellido }} {{ estudianteBase.segundo_apellido }}</li>
                  <li><strong>Programa de Estudio/Carrera:</strong> {{ estudianteBase.pnf }}</li>
                </ul>
              </li>
              <li>Confirmo que toda la informaci√≥n listada es correcta y completa a mi leal saber y entender.</li>
              <li>Entiendo y acepto que, posteriormente, debo validar esta declaraci√≥n mediante un c√≥digo OTP que recibir√© en mi correo electr√≥nico, el cual servir√° como mi firma electr√≥nica.</li>
              <li>Soy consciente de que cualquier falsedad en esta declaraci√≥n me hace sujeto a las sanciones aplicables seg√∫n las normativas acad√©micas y legales vigentes.</li>
            </ol>    
            <mat-form-field>
              <mat-label>Escriba "ACEPTO" para confirmar</mat-label>
              <input matInput formControlName="confirmacion">
              <mat-error *ngIf="secondFormGroup2.get('confirmacion')?.hasError('required')">Este campo es obligatorio.</mat-error>
              <mat-error *ngIf="secondFormGroup2.get('confirmacion')?.hasError('pattern')">Debe escribir "ACEPTO" (en may√∫sculas) para continuar.</mat-error>
            </mat-form-field>
          </div>

    <!-- Contenido para correcci√≥n de datos -->
    <div *ngIf="firstFormGroup1.get('datosCorrectos')?.value === 'no'">
      <label>Indique el o los datos incorrectos:</label>
      <div class="row">
        <div class="col-md-6 col-12">
          <mat-checkbox formControlName="cohorte">Cohorte de ingreso</mat-checkbox>
          <div *ngIf="secondFormGroup2.get('cohorte')?.value" class="explanation">
            Si seleccionaste esta opci√≥n es porque tu cohorte de ingreso est√° incorrecta. Si no, desmarca esta opci√≥n.
          </div>
        </div>
        <div class="col-md-6 col-12">
          <mat-checkbox formControlName="pnfCarrera">PNF/Carrera</mat-checkbox>
          <div *ngIf="secondFormGroup2.get('pnfCarrera')?.value" class="explanation">
            Si seleccionaste esta opci√≥n es porque tu carrera o PNF mostrado es incorrecto. Si no, desmarca esta opci√≥n.
          </div>
        </div>
        <div class="col-md-6 col-12">
          <mat-checkbox formControlName="multipleCarrera">M√∫ltiple carrera</mat-checkbox>
          <div *ngIf="secondFormGroup2.get('multipleCarrera')?.value" class="explanation">
            Selecciona esta opci√≥n si estudiaste varias carreras en la UNETRANS (antiguo IUT) y necesitas que se muestre la primera carrera que estudiaste en lugar de la √∫ltima. Si solo has estudiado una carrera, desmarca esta opci√≥n y selecciona "PNF/Carrera".
          </div>
        </div>
        <div class="col-md-6 col-12">
          <mat-checkbox formControlName="nombresApellidos">Nombres y Apellidos</mat-checkbox>
          <div *ngIf="secondFormGroup2.get('nombresApellidos')?.value" class="explanation">
            Si seleccionaste esta opci√≥n es porque sus nombres o apellidos est√°n incorrectos, completa los siguientes campos:
          </div>
        </div>
      </div>
      
      <div *ngIf="secondFormGroup2.get('nombresApellidos')?.value" class="row">
        <div class="col-md-3 col-12">
          <mat-form-field appearance="fill">
            <mat-label>Primer Nombre</mat-label>
            <input type="text" matInput formControlName="primerNombre" (input)="toUpperCase($event, 'primerNombre')">
            <mat-error *ngIf="secondFormGroup2.get('primerNombre')?.errors?.['required']">El primer nombre es obligatorio.</mat-error>
            <mat-error *ngIf="secondFormGroup2.get('primerNombre')?.errors?.['pattern']">Evita espacios al inicio o al final.</mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-3 col-12">
          <mat-form-field appearance="fill">
            <mat-label>Segundo Nombre</mat-label>
            <input type="text" matInput formControlName="segundoNombre" (input)="toUpperCase($event, 'segundoNombre')">
            <mat-error *ngIf="secondFormGroup2.get('segundoNombre')?.errors?.['pattern']">Evita espacios al inicio o al final.</mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-3 col-12">
          <mat-form-field appearance="fill">
            <mat-label>Primer Apellido</mat-label>
            <input type="text" matInput formControlName="primerApellido" (input)="toUpperCase($event, 'primerApellido')">
            <mat-error *ngIf="secondFormGroup2.get('primerApellido')?.errors?.['required']">El primer apellido es obligatorio.</mat-error>
            <mat-error *ngIf="secondFormGroup2.get('primerApellido')?.errors?.['pattern']">Evita espacios al inicio o al final.</mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-3 col-12">
          <mat-form-field appearance="fill">
            <mat-label>Segundo Apellido</mat-label>
            <input type="text" matInput formControlName="segundoApellido" (input)="toUpperCase($event, 'segundoApellido')">
            <mat-error *ngIf="secondFormGroup2.get('segundoApellido')?.errors?.['pattern']">Evita espacios al inicio o al final.</mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-12 col-12">
          <label>Adjunta tu documento de identidad en formato JPG</label>
          <div>
            <input type="file" (change)="onFileChange($event)" accept="image/jpeg">
            <mat-error *ngIf="fileError">{{fileError}}</mat-error>
          </div>
          <br>
        </div>
      </div>     
    </div>
    <div *ngIf="secondFormGroup2.errors?.['notChecked'] && firstFormGroup1.get('datosCorrectos')?.value === 'no'">
      <p class="error-message">Debe seleccionar al menos una opci√≥n de datos incorrectos para continuar.</p>
    </div>
    
    <button cButton btn btn-primary size="sm" matStepperNext [disabled]="!secondFormGroup2.valid || (firstFormGroup1.get('datosCorrectos')?.value === 'no' && secondFormGroup2.errors?.['notChecked'])">Continuar</button>
        </form>
      </mat-step>
    
      <!-- Paso 3: Verificaci√≥n de Correo Electr√≥nico -->
      <mat-step [stepControl]="thirdFormGroup3">
        <form [formGroup]="thirdFormGroup3">
          <ng-template matStepLabel>Verificaci√≥n de Correo Electr√≥nico</ng-template>
          <div>
            <br>
            <c-alert *ngIf="estudianteBase.estatus_migra === 0" color="info">
              <strong>Informaci√≥n Importante:</strong><br>
              Registra un <strong>correo de GMAIL v√°lido</strong> al que tengas acceso. Te enviaremos un c√≥digo de verificaci√≥n a esta direcci√≥n. <br>
              Verifica tu bandeja de entrada y la carpeta de SPAM. Para asistencia, contacta a: soportesice&#64;unetrans.edu.ve
            </c-alert>
            <c-alert *ngIf="estudianteBase.estatus_migra === 5" color="info">
              <strong>Informaci√≥n Importante:</strong><br>
              Tu correo electr√≥nico ya ha sido verificado anteriormente. Te enviamos un c√≥digo a <strong>{{ estudianteBase.email }}</strong> para completar el proceso inicial. <br>
              Verifica tu bandeja de entrada y la carpeta de SPAM. Para asistencia, contacta a: soportesice&#64;unetrans.edu.ve
            </c-alert>
            <label>Verificaci√≥n del correo electr√≥nico:</label>
            <div class="row">
              <div class="col-md-6 col-12">
                <mat-form-field appearance="fill">
                  <mat-label>Correo electr√≥nico</mat-label>
                  <input type="email" matInput formControlName="email">
                  <button mat-button matSuffix 
                          (click)="verifyEmail2()" 
                          [disabled]="!thirdFormGroup3.get('email')?.valid || emailDuplicado"
                  >
                    Verificar
                  </button>
                  <mat-error *ngIf="thirdFormGroup3.get('email')?.errors?.['emailDuplicado']">
                    El correo ya est√° registrado.
                  </mat-error>
                  <mat-error *ngIf="thirdFormGroup3.get('email')?.errors?.['pattern']">
                    Solo se aceptan correos de dominio &#64;gmail.com
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="col-md-6 col-12">
                <mat-form-field appearance="fill">
                  <mat-label>C√≥digo de verificaci√≥n</mat-label>
                  <input type="text" matInput formControlName="validationCode">
                  <button mat-button matSuffix (click)="validateCode2()" [disabled]="!thirdFormGroup3.get('validationCode')?.valid">Validar</button>
                  <mat-error *ngIf="thirdFormGroup3.get('validationCode')?.errors?.['minlength']">
                    El c√≥digo debe tener al menos 6 d√≠gitos.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>
        </form>
      </mat-step>
    </mat-vertical-stepper>    
  </div>

</div>
<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="closeModal()">Salir</button>
</div>